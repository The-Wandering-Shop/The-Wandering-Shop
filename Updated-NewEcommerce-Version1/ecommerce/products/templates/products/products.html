{% extends "core/base.html" %}
{% load static %}
{% block title %}Products - My Store{% endblock %}

{% block content %}

<div class="container mx-auto px-4 pb-16">
    {% if category %}
        <h2 class="text-2xl font-medium text-gray-800 uppercase mb-6 mt-12">
    {{ category.name }}
</h2>

    {% else %}

            {% if query %}
                <h2 class="text-2xl font-medium text-gray-800 uppercase mb-6 mt-12">Search Results for "{{ query }}"</h2>
            {% else %}
                <h2 class="text-2xl font-medium text-gray-800 uppercase mb-6 mt-12">All Products</h2>
            {% endif %}

    {% endif %}

  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">

    {% for product in products %}

    <div class="p-4 rounded-xl overflow-hidden flex flex-col hover:shadow-lg transition h-full bg-white">
        
        <!-- Product Image Block -->
        <div class="relative w-full h-60 flex items-center justify-center">
            <a href="{% url 'product:detail' product.category.slug product.slug %}" class="block w-full h-full">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-auto max-h-60 object-contain mx-auto">
                {% endif %}
            </a>
            {% if product.is_new %}
            <span class="absolute bottom-1 left-3 text-white bg-red-600 px-2 py-0.5 rounded text-sm">
                New
            </span>
            {% endif %}
        </div>

        <!-- Product Info -->
        <div class="p-3 flex-1 flex flex-col justify-between">
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-xl font-semibold">{{ product.name }}</h2>
                
                {% if user.is_authenticated %}
                <form method="post" action="{% url 'add_to_wishlist' product.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn likeBtn text-yellow-400 hover:text-red-500 transition duration-200">
                        <i class="fas fa-heart text-1xl"></i>
                    </button>
                </form>
                {% else %}
                <a href="{% url 'login' %}" class="text-blue-600 hover:underline text-sm">Log in to wishlist</a>
                {% endif %}
            </div>

            <p class="text-gray-500 mb-4">Price: R{{ product.price }}</p>

            {% if user.is_authenticated %}
            <form method="post" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <button type="submit"
                    class="bg-gradient-to-r from-yellow-500 to-yellow-300 hover:bg-red-500 transition duration-200 w-full py-2 text-center text-white rounded">
                    Add to cart
                </button>
            </form>
            {% else %}
            <a href="{% url 'user:login' %}" class="text-blue-600 hover:underline text-sm">Log in to add to cart</a>
            {% endif %}
        </div>

    </div>

    {% endfor %}
</div>


 {% block script %}
    <script>

        const likeBtn = document.getElementById("likeBtn");

        likeBtn.addEventListener ("click", () => {
            likeBtn.classList.add("text-red-500");
            likeBtn.classList.remove("text-yellow-400");
        }
        );
    </script>
{% endblock %}
    
    </div>
</div>


{% endblock %}
